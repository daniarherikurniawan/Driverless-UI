<!DOCTYPE html>
<html lang="en" style="overflow: hidden;">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <title>Sci-Learn</title>
  <meta name="generator" content="Bootply" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link href="../../stylesheets/bootstrap.min.css" rel="stylesheet"> 
  <link href="../../stylesheets/font-awesome.min.css" rel="stylesheet"> 

      <script src="../../javascripts/jquery.min.js"></script>
      <script src="../../javascripts/socket.io.js"></script>
      <script src="../../javascripts/chat.js"></script>


      <link href="../../stylesheets/styles.css" rel="stylesheet">
      <link rel="shortcut icon" type="image/png" href="../../images/logo.jpg"/>
      <script src="../../javascripts/jquery.min.js"></script>
      <script src="../../javascripts/socket.io.js"></script>
    </head>
    <body >
      <div class="wrapper">
        <div class="box">
          <div class="row row-offcanvas row-offcanvas-left">


            <!-- main right col -->
            <div class="column col-sm-12 col-xs-11" id="main" style="margin-top: 50px; width: 100%; height:95%">

              <!-- top nav -->
              <div class="navbar navbar-blue navbar-static-top">  
                <%> topNavigation%>
              </div>
              <!-- /top nav -->

              <div class="padding" style="    padding-top: 15px;">

               <div class="row" style="
                  align-content: center;
                  margin-left: auto;
                  margin-right: auto;
                  ">

                <div class="full col-sm-9" style="padding-top:0px">

                  <!-- content -->                      
                  <div class="row">

                   <!-- main col left --> 
                   <div class="col-sm-3 leftside">

                     <%> leftSide%>
                     

                   </div>
                   <!-- main col left --> 


                   <!-- main col right -->
                   <div class="col-sm-6 middle_display" style="padding-left:0px; padding-right:0px;">

                     <div class="well" style="padding: 15px; margin-bottom: 15px;"> 
                     <%#isReccPostPage%>
                     <div class= "text-center">
                      <b>Recommended Posts</b>
                     </div>
                     <%/isReccPostPage%>

                     <%#isPopularPostPage%>
                     <div class= "text-center">
                      <b>Popular Posts</b>
                     </div>
                     <%/isPopularPostPage%>

                     <%^isReccPostPage%>
                      <%^isPopularPostPage%>
                       <form action="/addPost" method="post" class="form-horizontal" role="form">
                         <div class="row">
                          <div class="col-sm-11" style="margin-right:-15px; padding-left: 0px; margin-left: -15px;">
                            <div class="row" style=" margin-top: 0px;">

                              <div class="row" style="margin-bottom: 0px;" >
                                <div class="col-sm-4" style="text-align: center; padding-left: 30px">
                                  <h4>What's New?</h4>
                                </div>
                                <div class="col-sm-8" style="padding-right: 0px; padding-left: 0px;">
                                  <textarea class="form-control" name="title" maxlength="40" style="height: 35px"placeholder="Title" required></textarea>
                                </div>
                              </div>

                              <div class="row" >
                                <div  class="col-sm-12" style=" padding-right: 0px;">
                                  <textarea class="form-control pull-left" name="keywords" style="height: 35px; margin left: -15px; "placeholder="Keywords" maxlength="55" required></textarea>
                                </div>
                              </div>

                            </div>
                          </div>

                          <div class="col-sm-1 pull-right" style="padding: 0 0 0 0 ; width:67px;height:67px;overflow:hidden">
                           <img style="width:67px;  position: absolute; left: 50%; top: 50%; 
                           -webkit-transform: translateY(-50%) translateX(-50%); -moz-transform: translateY(-50%) translateX(-50%) "src="/images/<%profile.email%>/profile/<%profile.img_profile_name%>">
                         </div>

                       </div>
                       <div id="" class="sss form-group" style="padding:4px 15px 4px 14px;; margin-bottom:5px ">


                        <textarea name="content" class="form-control auto-resize" placeholder="Share your knowledge" required rows="2" style="height:60px;" id="texta"></textarea>

                      </div>

                      <input class="btn btn-primary pull-right" type="submit" value="Post"><ul style="margin-bottom: -5px;" class="list-inline"><li style=" padding-top: 11px;"><a href=""><i class="glyphicon glyphicon-paperclip"></i></a></li><li><a href=""><i class="glyphicon glyphicon-camera"></i></a></li><li><a href=""><i class="glyphicon glyphicon-map-marker"></i></a></li></ul>
                    </form>
                    <%/isPopularPostPage%>
                    <%/isReccPostPage%>

                  </div>

                  <%# posts %>

                  <div class="panel panel-default" style="" id="<%_id%>" >
                    <div class="row" id="<%_id%>row">

                      <div class="col-sm-2" style=" padding-left: 0px;">
                       <div class="panel-heading" id="<%_id%>theImage">
                        <a href="/profile/<%creator.email%><%^creator.name%><%profile.email%><%/creator.name%>"  class="pull-left">   
                          <%#creator.name%>
                          <div class="col-sm-1"  id="<%creator._id%>editableImage" style="padding: 0 0 0 0 ; width:90px;height:90px;overflow:hidden; margin: 3px 10px 0px 0px">
                            <%/creator.name%>

                          <%^creator.name%>
                          <div class="col-sm-1"  id="<%_id%>editableImage" style="padding: 0 0 0 0 ; width:90px;height:90px;overflow:hidden; margin: 3px 10px 0px 0px">
                              <%/creator.name%>

                              <img style=" width:90px; position: absolute;left: 50%; top: 50%; -webkit-transform: translateY(-50%) translateX(-50%); -moz-transform: translateY(-50%) translateX(-50%) ;"src="/images/<%creator.email%><%^creator.name%><%profile.email%><%/creator.name%>/profile/<%creator.img_profile_name%><%^creator.name%><%profile.img_profile_name%><%/creator.name%>">
                            </div>

                          </a> 
                        </div>
                      </div>

                      <div class="col-sm-10" style=" margin-top: 5px;">
                        <div class="row">
                          <div class="col-sm-11" style="padding-left:0px">
                            <%#creator.name%>
                            <a href="/profile/<%creator.email%>"><h4 style="margin-bottom: 0px;" id="<%creator._id%>editableName"><b >
                              <%creator.name%>
                              <%/creator.name%>
                              <%^creator.name%>
                              <a href="/profile/<%profile.email%>"><h4 style="margin-bottom: 0px;" id="<%_id%>editableName"><b> 
                                 <%profile.name%>  
                              <%/creator.name%>
                              </b></h4> </a>
                            </div>
                            <div class="col-sm-1 " style="margin-top: 8px;padding-right: 0px;padding-left: 27px;">

                              <li class="dropdown" style="list-style-type: none;">
                                <a href="" data-toggle="dropdown"><i class="glyphicon glyphicon-chevron-down" style="top:-3px"></i></a>
                                <ul class="dropdown-menu" style="left:-101px; top:13px;    min-width: 120px; ">

                                  <%^creator.name%>
                                  <li><a class="btn " style="text-align: left;" type="button" onclick="editPost('<%_id%>','<%profile._id%>')"><i class="glyphicon glyphicon-pencil "></i>&nbsp; Edit</a></li>
                                  <%/creator.name%>
                                  <li><a class="btn" style="text-align: left;" type="button" href=""><i class="glyphicon glyphicon-bookmark "></i>&nbsp; Keep</a></li>
                                  <%#creator.name%>
                                  <li><a class="btn" style="text-align: left;" type="button" href=""><i class="fa fa-share "></i>&nbsp; Share</a></li>
                                  <%/creator.name%>

                                  <%^creator.name%>
                                  <li>
                                   <a class="btn" style="text-align: left;" type="button" onclick="tryToDelete('<%_id%>','<%profile._id%>')"><i class="glyphicon glyphicon-remove "></i>&nbsp; Delete</a></li>
                                   <%/creator.name%>
                                 </ul>
                               </li>
                             </div>
                           </div>

                           <script type="text/javascript">
                            start = new Date("<%date_created%>");
                            end = new Date();
                            diff_time = diff(start,end);
                            function diff(startDate, endDate) {
                                var diff = endDate.getTime() - startDate.getTime();
                                console.log(diff)
                                var days = Math.floor(diff / 1000 / 60 / 60 / 24);
                                diff -= days * 1000 * 60 * 60 * 24;
                                var hours = Math.floor(diff / 1000 / 60 / 60);
                                diff -= hours * 1000 * 60 * 60;
                                var minutes = Math.floor(diff / 1000 / 60);
                                diff -= minutes * 1000 * 60;
                                diff = Math.floor(diff / 1000);
                                seconds = diff;
                                if (days > 0)
                                  return  (days + " days ago");
                                else if (hours > 0)
                                  return  (hours + " hours ago");
                                else if (minutes > 0)
                                  return  (minutes + " minutes ago");
                                else if (seconds < 15)
                                  return  (" just now");
                                else 
                                  return  (seconds + " seconds ago");
                                
                            }

                           </script>

                           <p><small class="posting_time"><script>document.write(diff_time)</script></small></p>
                           <%#title%>
                           <h5 style="margin-bottom: 5px;" >Title: <a href="/post/<%_id%>" id = "<%_id%>editableTitle">  <b><%title%></b> </a> </h5>
                           <%#keywords%>
                           <hr style="margin:5px 0px 0px 0px">
                           Keywords: <a href="#"  id = "<%_id%>editableKeywords"><%keywords%></a>
                           <%/keywords%>
                           <%/title%>

                           <%^title%>
                           <h5 style="margin-bottom: 5px;" > shared <a href="/profile/<%original_creator.email%><%^original_creator.name%><%profile.email%><%/original_creator.name%>"><b >
                              <%original_creator.name%><%^original_creator.name%><%profile.name%><%/original_creator.name%>
                              </b></a>'s post
                              </h5> 
                           <hr style="margin:5px 0px 0px 0px">
                           Keywords: <a href="#"  ><%post_shared.keywords%></a>
                           <%/title%>
                         </div>

                       </div> <!-- row -->

                       <div class="panel-body" style="padding:10px 15px 15px 15px">
                         <p style="word-wrap: break-word;    white-space: normal; " id = "<%_id%>editableContent"><%content%></p>







              <%^title%>

                  <div class="panel panel-default" style="margin-bottom:10px; background-color: rgb(243, 249, 249);"  >

                  <%^post_shared%>
                    <b>Post has been deleted.</b>
                  <%/post_shared%>
                  <%#post_shared%>
                    <div class="row ">

                      <div class="col-sm-1" style=" padding-left: 0px; margin-right:10px">
                       <div class="panel-heading" >
                        <a href="/profile/<%original_creator.email%><%^original_creator.name%><%profile.email%><%/original_creator.name%>"  class="pull-left">   
                          <div class="col-sm-1"  style="padding: 0 0 0 0 ; width:50px;height:50px;overflow:hidden; margin: 0px 10px 0px 0px">
                              <img style=" width:50px; position: absolute;left: 50%; top: 50%; -webkit-transform: translateY(-50%) translateX(-50%); -moz-transform: translateY(-50%) translateX(-50%) ;"src="/images/<%original_creator.email%><%^original_creator.name%><%profile.email%><%/original_creator.name%>/profile/<%original_creator.img_profile_name%><%^original_creator.name%><%profile.img_profile_name%><%/original_creator.name%>">
                            </div>

                          </a> 
                        </div>
                      </div>
                      <div class="col-sm-10" style="margin-top: 5px; ">
                        <div class="row">
                           <h5 >Title: <a href="/post/<%post_shared._id%>"><b><%post_shared.title%></b></a></h5>
                          </div>


                          <div class="input-group" style="margin-right:-42px; margin-top: -9px;">
                          <div class="input-group-btn" style="font-size:10px">
                            <a type="button" class="btn btn-default" style="padding: 4px 5px 4px 0px;   background-color: rgb(243, 249, 249); font-size: 12px;  border-color: transparent;"><i    class="fa fa-share">&nbsp; <%post_shared.share.length%></i></a>
                            <a type="button" class="btn btn-default" style="padding: 4px 5px 4px 5px;   background-color: rgb(243, 249, 249); font-size: 12px;  border-color: transparent;"><i class="fa fa-thumbs-up">&nbsp; <%post_shared.like.length%> </i></a>
                            <a type="button" class="btn btn-default" style="padding: 4px 5px 4px 5px;   background-color: rgb(243, 249, 249); font-size: 12px;  border-color: transparent;"><i  class="fa fa-comments-o">&nbsp; <%post_shared.comments.length%></i></a>
                          </div>
                          <div class="pull-right" style="width: 100%">       
                            <%#creator.name%>
                            <%#original_creator%>
                            <a type="button" onclick="<%^post_shared.shared%>initiateSharedThought('<%post_shared._id%>','<%original_creator._id%>'); init('additionalThought',200);<%/post_shared.shared%>"  data-toggle="modal" class="btn btn-default" href="<%^post_shared.shared%>#shareModal<%/post_shared.shared%>"  style="float: right;"><i id="iconShare<%_id%>"  style="<%#post_shared.shared%>color:rgb(45, 99, 99)<%/post_shared.shared%>"  class="fa fa-share"></i></a>
                            <%/original_creator%>
                            <%/creator.name%>
                          </div>
                        </div>

                         </div>

                       </div> <!-- row -->

                       <div class="panel-body" style="padding:0px 15px 5px 15px">
                         <span style="word-wrap: break-word;    white-space: normal; " ><%post_shared.content%></span>

                      
                      </div>
                      <%/post_shared%>
              </div>


              <%/title%>





                         <div class="input-group">
                          <div class="input-group-btn">
                          <%#title%>
                            <a type="button" id="buttonShare<%_id%>" onclick="showShares('<%_id%>')" class="btn btn-default" style="padding: 4px 5px 4px 5px;     border-color: transparent;"><i id="share<%_id%>"  class="fa fa-share">&nbsp; <%share.length%></i></a>
                          <%/title%>
                            <a type="button" id="buttonLike<%_id%>" onclick="showLikes('<%_id%>')" class="btn btn-default" style="padding: 4px 5px 4px 5px;     border-color: transparent;"><i id="like<%_id%>"  class="fa fa-thumbs-up">&nbsp; <%like.length%> </i></a>
                            <a type="button" id="button<%_id%>" onclick="showComments('<%_id%>')" class="btn btn-default" style="padding: 4px 5px 4px 5px;     border-color: transparent;"><i  id="comment<%_id%>" class="fa fa-comments-o">&nbsp; <%comments.length%></i></a>
                          </div>

                          <div class="pull-right" style="width: 100%">
                            <input onclick ="init('baby')" type="text" name="<%_id%>" id="comment" style="float: right;margin-left:0px;width: 80%;"  class="form-control comment" placeholder="Give a quick comment.. (Press 'enter' when finished)">

                            <a type="button" class="btn btn-default" onclick="sendLike('<%_id%>')" style="float: right; " ><i id ="iconLike<%_id%>" style="<%#liked%>color:rgb(45, 99, 99)<%/liked%>" class="fa fa-thumbs-up"></i></a>
                            <!-- onclick="sendShare('<%_id%>')" -->
                            <%#creator.name%>      
                            <%#title%>            
                            <a type="button" onclick="<%^shared%>initiateSharedThought('<%_id%>','<%creator._id%>'); init('additionalThought',200);<%/shared%>"  data-toggle="modal" class="btn btn-default" href="<%^shared%>#shareModal<%/shared%>"  style="float: right;"><i id="iconShare<%_id%>"  style="<%#shared%>color:rgb(45, 99, 99)<%/shared%>"  class="fa fa-share"></i></a>
                            <%/title%>
                            <%/creator.name%>
                          </div>

                        </div>
                      </div>
                      <div id="showComment<%_id%>">
                </div>
              </div>

              <%/ posts %>

              <div class="text-center">
                
                <div class="row" >
                  <ul class="pagination" id="pagination">
                  </ul>
                </div>
                <div id="statePage">
                   Let's   <a href="/search"> <button class=" btn btn-md btn-primary" >Find</button> </a> a new connections !
                </div>
                <!-- <hr> -->
              </div>

            </div>

<style type="text/css">
  #rightSideBar::-webkit-scrollbar { 
    display: none; 
}

</style>


            <div id="rightSideBar" class=" col-sm-3 rightside" style="overflow:auto" >
               <%> rightSide%> 

            </div>

          </div><!--/row


      </div><!-- /padding -->
    </div>
    <!-- /main -->

  </div>
</div>
</div>

<script>
// alert('<%showFriends%><%^showFriends%><%showFriends%><%/showFriends%>'== 'true' )
  str = "";
  var numOfLastPage = <%numOfLastPage%>;
  var numOfCurrPage = <%numOfCurrPage%>+1;

      // alert(<%numOfLastPage%>+"  "+<%numOfCurrPage%>)
  if(numOfCurrPage <= numOfLastPage){
      limitIndexPage = 10;
      if(numOfLastPage < 10)
        limitIndexPage = numOfLastPage-1;

      firstIndexPage = 1; //numOfLastPage
      if(numOfCurrPage > 5)
        if( numOfCurrPage+5 <= numOfLastPage)
          firstIndexPage = numOfCurrPage-5;
        else 
          firstIndexPage = numOfLastPage - limitIndexPage;


      //add first page
      str +=  "<li";
      if(1 == numOfCurrPage)
          str += " class=\"active\"";
      str += "><a href=\"/home/"+0+"/<%limitPerPage%>\">"+'First'+"</a></li>";

      //add first intermediate page
      if(numOfLastPage > 11 && 2 < firstIndexPage+1){
        intermediateIndex = Math.ceil(firstIndexPage/2);
        str +=  "<li><a href=\"/home/"+(intermediateIndex)+"/<%limitPerPage%>\">"+"..."+"</a></li>";
      }

      lastIndexPage = firstIndexPage + limitIndexPage - 1;
      for (var i = firstIndexPage + 1; i <= lastIndexPage; i++) {
        str +=  "<li";
        if(i == numOfCurrPage)
          str += " class=\"active\"";
        str += "><a href=\"/home/"+(i-1)+"/<%limitPerPage%>\">"+(i)+"</a></li>";
      };

      //add last intermediate page
      if(numOfLastPage > 11 && (numOfLastPage-1) > lastIndexPage){
        intermediateIndex = Math.floor(lastIndexPage+((numOfLastPage - lastIndexPage) /2)-1);
        str +=  "<li><a href=\"/home/"+(intermediateIndex)+"/<%limitPerPage%>\">"+"..."+"</a></li>";
      }

       //add last page
      if(numOfLastPage > 1){
        str +=  "<li";
        if(numOfLastPage == numOfCurrPage)
            str += " class=\"active\"";
        str += "><a href=\"/home/"+(numOfLastPage-1)+"/<%limitPerPage%>\">"+'Last'+"</a></li>";
      }

      lastResult = 0;
      if(numOfCurrPage==numOfLastPage){
        lastResult = '<%numOfPost%><%numOfFriend%>';
      }
      else
        lastResult = (numOfCurrPage*<%limitPerPage%>);
      if('<%isPopularPostPage%><%^isPopularPostPage%>'=='false<%/isPopularPostPage%>'){
        // alert("dd")
        $("#pagination").remove();
        if(lastResult != 0)
          document.getElementById("statePage").innerHTML = "Showing "+(<%numOfCurrPage%>*<%limitPerPage%>+1)+" - "+lastResult+" results<p>";
        else
          document.getElementById("statePage").innerHTML = "There is no posts at this time!";

       }else {
          document.getElementById("pagination").innerHTML = str;
          document.getElementById("statePage").innerHTML = "Showing "+(<%numOfCurrPage%>*<%limitPerPage%>+1)+" - "+lastResult+" results<p><b>Page "+numOfCurrPage+" of "+numOfLastPage+"<b></p>";
        }
  }
</script>


<!--share modal-->
<div id="shareModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4> Share a Post </h4>
      </div>
      <form onsubmit="return tryToShare()" id="editableShareFunction" class="form center-block">
        <div class="modal-body">
          <div class="form-group">
            <textarea  id="additionalThought" style="word-wrap: break-word;white-space: normal;" class=" auto-resize form-control input-lg" autofocus="" placeholder="What is your thought about this post?" required=""></textarea>

          </div>

          <!-- shared post -->
          <div class="panel panel-default" style="margin-bottom:0px" id="sss" >
            <div class="row" id="row">

              <div class="col-sm-2" style=" padding-left: 0px;">
               <div class="panel-heading" >

                   <a id="linkSharedImage" href="sapai"  class="pull-left">   
                  <div class="col-sm-1"  style="padding: 0 0 0 0 ; width:90px;height:90px;overflow:hidden; margin: 3px 10px 0px 0px">

                      <img id="sourceSharedImage" style=" width:90px; position: absolute;left: 50%; top: 50%; -webkit-transform: translateY(-50%) translateX(-50%)  ; -moz-transform: translateY(-50%) translateX(-50%) ;"src="">
                    </div>
                  </a> 

               </div>
             </div>

             <div class="col-sm-10" style="margin-top: 7px;">
              <div class="row">
                <div class="col-sm-11" style="padding-left:0px">
                  <h4 style="margin-bottom: 0px;" id="sharedName"><b >fnkernfek
                  </b></h4>

                </div>
              </div>

              <h4  id = "sharedTitle">salah  </h4>
              <hr style="margin:5px 0px 5px 0px">
              Keywords: <a href="#"  id = "sharedKeywords"><%keywords%></a>
            </div>

          </div> <!-- row -->

          <div class="auto-resize panel-body" style="word-wrap: break-word;    white-space: normal;padding:10px 15px 0px 15px">
           <p id = "sharedContent">salah</p>


         </div>
       </div>
       <!-- shared post -->


     </div>
     <div class="modal-footer">
      <div>
       <button class=" btn btn-md btn-primary" type="submit">Share</button>

        <ul class="pull-left list-inline"><li><a href=""><i class="glyphicon glyphicon-upload"></i></a></li><li><a href=""><i class="glyphicon glyphicon-camera"></i></a></li><li><a href=""><i class="glyphicon glyphicon-map-marker"></i></a></li></ul>
      </div>	
    </div>
  </form>
</div>
</div>
</div>


<!-- Modal untuk edit post -->

<div class="panel panel-default modal fade" id="templateEdit" aria-hidden="true" >
  <form id="needAction" action="/updatePost" method="post">
    <div class="row">
      <div class="col-sm-2" style=" padding-left: 0px;">
       <div class="panel-heading">
        <a href="/" class="pull-left">    
          <div class="col-sm-1" id="editableImage" style="padding: 0 0 0 0 ; width:90px;height:90px;overflow:hidden; margin: 3px 10px 0px 0px">
           <img style=" width:90px; position: absolute;left: 50%; top: 50%; -webkit-transform: translateY(-50%) translateX(-50%); -moz-transform: translateY(-50%) translateX(-50%) ;"src="">
         </div>
       </a> 
     </div>
   </div>
   <div class="col-sm-10" style="margin-top: 7px;">

    <h4 style="margin-bottom: 0px;" id = "editableName" ><b>
      Paijo  </b></h4> 
      <textarea id = "editableTitle" class="form-control" name="title" maxlength="40" style="height: 35px; margin: 3px 0px 3px 0px;"placeholder="Title" required>title</textarea>
      <textarea id = "editableKeywords" class="form-control pull-left" name="keywords" style="height: 35px; margin left: -15px; "placeholder="Keywords" maxlength="55" required>Keywords</textarea>
    </div>
  </div> <!-- row -->
  <div class="panel-body" style="padding:3px 15px 15px 15px">
    <div class="form-group" style="padding:0px 0px 4px 0px;; margin-bottom:5px ">
      <textarea  id = "editableContent"  name="content" class="form-control auto-resize" placeholder="Share your knowledge"  required rows="2" style="height:1em;" ></textarea>
    </div>



    <div class="pull-right">
      <a id="targetId" onclick="cancelEditPost()" class="btn btn-md btn-default" type="">Cancel
      </a> &nbsp;  
      <button class=" btn btn-md btn-primary" type="submit">Save</button>
    </div>
  </div>
</form>
</div>


<!--photo modal-->
<div id="photoModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content" style="width:70%; left:15%">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4> Edit Photo Profile</h4>
      </div>
      <div class="modal-body">
        <div class="panel panel-default">
          <div class="panel-thumbnail">
            <a href="#photoModal" role="button" data-toggle="modal"><img src="/images/<%profile.email%>/profile/<%profile.img_profile_name%>" width="100%" class="img-responsive" ></a>
          </div>
        </div>
      </div>

      <div class="modal-footer" style="padding-left: 25px; padding-right: 20px; padding-bottom: 0px;">
        <button class="btn btn-primary btn-sm" data-dismiss="modal" aria-hidden="true" > <span class="glyphicon glyphicon-trash" ></span>&nbsp;&nbspDelete</button>
        <button class="btn btn-primary btn-sm" data-dismiss="modal" aria-hidden="true" onClick="triggermyNewProfilePicture()" > <span class="glyphicon glyphicon-folder-open " ></span>&nbsp;&nbspUpload</button>

        <ul class="pull-left list-inline" ><li>
          <a href=""><i class="glyphicon glyphicon-thumbs-up" style="color:rgb(45, 99, 99); font-size: 25px;"></i></a></li><li>
          <a href=""><i class="glyphicon glyphicon-comment" style="color:rgb(45, 99, 99); font-size: 25px;"></i></a></li><li>
        </ul>
        <ul class="pull-right list-inline"><li>

          <form name="upload" id="submitPicture" method="post" action="/upload_img_profile"  enctype="multipart/form-data" style="width:0px" >
            <input style="visibility:hidden"  onchange="submitForm()" name= "img_profile" type="file" id="myNewProfilePicture">
          </form>

        </ul>       

      </div>
    </div>
  </div>
</div>
<!-- script references -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
<script src="../../javascripts/bootstrap.min.js"></script>
<script src="../../javascripts/scripts.js"></script>
</body>
</html>

<script>

  function tryToShare(id_post, original_creator){
    // alert("ahooy");
    var content =  $('#additionalThought').val();

    var http = new XMLHttpRequest();
    http.open("POST", "/addShare", true);
    http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    var params = "id_post=" + window.encodeURIComponent(id_post)+ "&content="+window.encodeURIComponent(content)+ "&original_creator="+window.encodeURIComponent(original_creator); // probably use document.getElementById(...).value
    http.send((params));
    http.onload = function() {
      if(http.responseText=="404"){
        //error
        alert(http.responseText);
      }else{
      
      }
    }
  }


  function initiateSharedThought(id,id_creator){
  // alert(id);
  var http = new XMLHttpRequest();
    http.open("POST", "/dataPost", true);
    http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    var params = "id=" + window.encodeURIComponent(id);
    http.send((params));
    // alert("ahhha")
    http.onload = function() {
      if(http.responseText=="404"){
        //error
        alert(http.responseText);
      }else{
        post = JSON.parse(http.responseText);
        // console.log(post);
        // alert("dcdcdc");
        document.getElementById('sharedName').innerHTML = post.creator.name ; 
        document.getElementById('sharedContent').innerHTML = post.content;
        document.getElementById('sharedKeywords').innerHTML = post.keywords;
        document.getElementById('sharedTitle').innerHTML = post.title; 
        $('#linkSharedImage').attr('href',"/profile/"+post.creator.email);
        // alert($('#sourceSharedImage').attr('src'));
        $('#sourceSharedImage').attr('src',"/images/"+post.creator.email+"/profile/"+post.creator.img_profile_name);
        // alert($('#sourceSharedImage').attr('src'));
        $('#editableShareFunction').attr("onsubmit", "return tryToShare('"+id+"','"+id_creator+"')");
        $('#additionalThought').val("");
      }
    }
  // alert("ini "+$('#editableShareFunction').attr("onsubmit"));

  
  // alert("ini "+$('#editableShareFunction').attr("onsubmit"));
}

function test(str){
  alert(str);
}

function triggermyNewProfilePicture() {
  document.getElementById("myNewProfilePicture").click();

}

function submitForm(){
  var delay=200; //1 seconds
  setTimeout(function(){
    document.getElementById("submitPicture").submit();
    //window.alert("Photo profile is successfully updated!");
  }, delay); 
}

  var genuine = null;

  function editPost(id,id_creator){
    if (genuine == null){
      var newValue = "cancelEditPost('"+id+"')";
      $('#targetId').attr('onclick',newValue);
      var newAction = "/updatePost/"+id+"/"+id_creator;
      //window.alert(newAction);
      $('#needAction').attr('action',newAction);
      document.getElementById('editableTitle').innerHTML = document.getElementById(""+id+'editableTitle').textContent;
      document.getElementById('editableName').innerHTML = document.getElementById(""+id+'editableName').textContent;
      document.getElementById('editableImage').innerHTML = document.getElementById(""+id+'editableImage').innerHTML;
      document.getElementById('editableKeywords').innerHTML =   document.getElementById(""+id+'editableKeywords').textContent;
      document.getElementById('editableContent').innerHTML =   document.getElementById(""+id+'editableContent').textContent;
      genuine = document.getElementById(id).innerHTML;
      var template = document.getElementById('templateEdit').innerHTML;
      document.getElementById(id).innerHTML = template;
      init("editableContent",0);
    }else{
      window.alert("You should finish your current editing before edit another one! ")
    }
  }
  //567d12d5e5e456ea33c7fb94

  function cancelEditPost(id){
    document.getElementById(id).innerHTML = genuine  ;
    genuine = null;
  }


  function tryToDelete(id, id_creator) {
    var http = new XMLHttpRequest();
    http.open("POST", "/deletePost", true);
    http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    var params = "id=" + window.encodeURIComponent(id)+ "&creator="+window.encodeURIComponent(id_creator); // probably use document.getElementById(...).value
    http.send((params));
    http.onload = function() {
      if(http.responseText=="404"){
        //error
        alert(http.responseText);
      }else{
        // alert("Delete success!");
        var id="#"+http.responseText;
        $(id).remove();
      }
    }
  }


  function tryToDeleteComment(id, post_id) {
    var http = new XMLHttpRequest();
    http.open("POST", "/deleteComment", true);
    http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    var params = "id=" + window.encodeURIComponent(id)+ "&post_id="+window.encodeURIComponent(post_id); // probably use document.getElementById(...).value
    // alert(params);
    http.send((params));
    http.onload = function() {
      if(http.responseText=="404"){
        //error
        alert(http.responseText);
      }else{
        //refresh comment
        // alert(http.responseText);
        commentNumber = document.getElementById('comment'+post_id)
        .innerHTML.replace('&nbsp; ','').replace(' ','');
          // alert  ;
          document.getElementById('comment'+post_id).innerHTML = "&nbsp; "+((+commentNumber)-1);
          showComments(post_id);
        }
      }
    }

// give comment
// I should filter whether is it a tag inthe string or not
// var id_creator= <%-profile._id %>;
var id_creator = '<%profile._id%>';
$(function() {
  $('input#comment').on('keyup', function(e) {
    if (e.which == 13 && ! e.shiftKey) {
      var id = this.name;
      var content = $(this).val();

      var http = new XMLHttpRequest();
      http.open("POST", "/addComment", true);
      http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
      var params = "id=" + window.encodeURIComponent(id)+ "&creator="+window.encodeURIComponent(id_creator)
         +"&content="+window.encodeURIComponent(content); // probably use document.getElementById(...).value

         http.send((params));
         http.onload = function() {
          if(http.responseText=="404"){
          //error
          alert(http.responseText);
        }else{
          //alert(http.responseText);
          var commentNumber = document.getElementById('comment'+id)
          .innerHTML.replace('&nbsp; ','').replace(' ','');
          // alert  ;
          document.getElementById('comment'+id).innerHTML = "&nbsp; "+((+commentNumber)+1);
          var name = "input[name="+id+"]";
          $(name).attr("placeholder", "Your comment has been added ..");
          $(name).val("");
          showComments(id);
        }
      }

    }
  });

});

function hideComments(id2){
 iddNew="showComment"+id2;
 newOnClick2 = "showComments('"+id2+"')";
 buttonOnClick = "#button"+id2;
 $(buttonOnClick).css("color", "#3b9798");
 $(buttonOnClick).attr("onClick", newOnClick2);
 document.getElementById(iddNew).innerHTML ="";
}

var myEmail = '<%profile.email%>'

function showComments(id3){
    
    normalizeButton(id3);
    //getElementById("showComment"+id).innerHTML = "lalala";
    post_id = id3;
    var http = new XMLHttpRequest();
    http.open("POST", "/getComment", true);
    http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    var params = "id=" + window.encodeURIComponent(id3);
    http.send((params));
    http.onload = function() {
      if(http.responseText=="404"){
          //error
          alert(http.responseText);
        }else{


         comments = JSON.parse(http.responseText);

          //build the comments div
          newComments = "";
          for ( i = 0;i <=  comments.length - 1; i++) {

            newComments += 
            "<div class=\"well\" style=\"padding:10px 15px 10px 15px; margin-bottom:0px\"> "+
            "<div class=\"row\">"+
            "<div class=\"col-sm-1 pull-left\" style=\"padding: 0 0 0 0 ; "+
            "width:40px;height:40px;overflow:hidden\">"+
            "<img style=\"width:40px;  position: absolute; left: 50%; top: 50%; "+
            "-webkit-transform: translateY(-50%) translateX(-50%);  -moz-transform: translateY(-50%) translateX(-50%) ;\"src=\"/images/"+
            comments[i].creator.email+"/profile/"+comments[i].creator.img_profile_name+"\">"+
            "</div>"+
            "<div class=\"col-sm-10 pull-left\" style=\"padding: 0 0 0px 0px; margin: 0 0 0px 10px\">"+
            "<a href=\"/profile/"+
            comments[i].creator.email+"\"><b>"+
            comments[i].creator.name+"</b></a>"+
            "</div>";

            if(comments[i].creator.email == myEmail){

              newComments += "<div class=\"col-sm-1 \" style=\"margin-top: 0px;padding-right: 0px;padding-top: 0px; padding-left: 30px;\">"+
              " <li class=\"dropdown\" style=\"list-style-type: none;  text-align: right;\">"+
              "<a href=\"\" data-toggle=\"dropdown\"><i class=\"glyphicon glyphicon-chevron-down\" style=\""+"top:1px; font-size: 12px;\"></i></a>"+
              "<ul class=\"dropdown-menu\" style=\"left:-75px; top:16px;    min-width: 103px; \">"+
              "<li><a  style=\"text-align: left;\"class=\"btn \" type=\"button\" onclick=\"editComment('"+comments[i]._id+"','"+post_id+"')\"><i "+"class=\"glyphicon glyphicon-pencil\" style=\"font-size:12px; color:black\"  ></i>&nbsp; Edit</a></li>"+
              "<li>"+
              " <a style=\"text-align: left;\" class=\"btn\" type=\"button\" onclick=\"tryToDeleteComment('"+comments[i]._id+"','"+post_id+"')\"><i "+"class=\"glyphicon glyphicon-remove \"  style=\"font-size:12px; color:black\"></i>&nbsp; "+"Delete</a></li>"+
              "</ul>"+
              " </li>"+
              "</div>";
            }


            newComments += "<div class=\"col-sm-11 pull-left\" style=\"padding: 0 0 0px 0px; overflow-wrap: break-word; "+
            "margin: 0 0 0 10px\">"+
            comments[i].content+"</div>"+
            "</div>"+
            "</div>";

          };
          // alert(newComments);
          //put generated html to the div
          buttonOnClick = "#button"+id3;
          newOnClick = "hideComments('"+id3+"')";
          $(buttonOnClick).attr("onClick", newOnClick);
          $(buttonOnClick).css("color", "rgb(45, 99, 99)");
          idd="showComment"+id3;
          document.getElementById(idd).innerHTML =newComments;
        }

        
      }

    }

function hideLike(id2){
  // alert("lalal");
 iddNew="showComment"+id2;
 newOnClick2 = "showLikes('"+id2+"')";
 buttonOnClick = "#buttonLike"+id2;
 $(buttonOnClick).css("color", "#3b9798");
 $(buttonOnClick).attr("onClick", newOnClick2);
 document.getElementById(iddNew).innerHTML ="";
 // alert( $(buttonOnClick).attr("onClick"));
}



function hideShare(id2){
  // alert("lalal");
 iddNew="showComment"+id2;
 newOnClick2 = "showShares('"+id2+"')";
 buttonOnClick = "#buttonShare"+id2;
 $(buttonOnClick).css("color", "#3b9798");
 $(buttonOnClick).attr("onClick", newOnClick2);
 document.getElementById(iddNew).innerHTML ="";
 // alert( $(buttonOnClick).attr("onClick"));
}


function showLikes(id3){
    
    normalizeButton(id3);
    //getElementById("showComment"+id).innerHTML = "lalala";
    // alert("lalala");
    post_id = id3;
    var http = new XMLHttpRequest();
    http.open("POST", "/getLike", true);
    http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    var params = "id=" + window.encodeURIComponent(id3);
    http.send((params));
    http.onload = function() {
      if(http.responseText=="404"){
          //error
          alert(http.responseText);
        }else{

         likes = JSON.parse(http.responseText);

          //build the comments div
          newLike = "";
          // alert("dd  "+likes.length)
          for ( i = 0;i <=likes.length - 1; i++) {

            newLike += 
            "<div class=\"well\" style=\"padding:10px 15px 10px 15px; margin-bottom:0px\"> "+
            "<div class=\"row\">"+
            "<div class=\"col-sm-1 pull-left\" style=\"padding: 0 0 0 0 ; "+
            "width:40px;height:40px;overflow:hidden\">"+
            "<img style=\"width:40px;  position: absolute; left: 50%; top: 50%; "+
            "-webkit-transform: translateY(-50%) translateX(-50%);  -moz-transform: translateY(-50%) translateX(-50%) ;\"src=\"/images/"+
            likes[i].email+"/profile/"+likes[i].img_profile_name+"\">"+
            "</div>"+
            "<div class=\"col-sm-10 pull-left\" style=\"padding: 0 0 0px 0px; margin: 0 0 0px 10px\">"+
            "<a href=\"/profile/"+
            likes[i].email+"\"><b>"+
            likes[i].name+"</b></a>"+
            "</div>";

            newLike += "<div class=\"col-sm-11 pull-left\" style=\"padding: 0 0 0px 0px; overflow-wrap: break-word; "+
            "margin: 0 0 0 10px\">"+
            likes[i].occupation+"</div>"+
            "</div>"+
            "</div>"+
            "</div>";

          };
          // alert(newLike);
          //put generated html to the div
          buttonOnClick = "#buttonLike"+id3;
          newOnClick = "hideLike('"+id3+"')";
          $(buttonOnClick).attr("onClick", newOnClick);
          $(buttonOnClick).css("color", "rgb(45, 99, 99)");
          idd="showComment"+id3;
          document.getElementById(idd).innerHTML =newLike;
        }

        
      }

    }

function normalizeButton(id3){
          idd="showComment"+id3;
          document.getElementById(idd).innerHTML ="";
   $('#buttonLike'+id3).css('color','#3b9798');
    $('#buttonLike'+id3).attr('onClick',"showLikes('"+id3+"')");
   $('#buttonShare'+id3).css('color','#3b9798');
    $('#buttonShare'+id3).attr('onClick',"showShares('"+id3+"')");
   $('#button'+id3).css('color','#3b9798');
    $('#button'+id3).attr('onClick',"showComments('"+id3+"')");
    // alert("hhhho");
}


function showShares(id3){
    
    normalizeButton(id3);

    // alert('lala');
    //getElementById("showComment"+id).innerHTML = "lalala";
    // alert("lalala");
    post_id = id3;
    var http = new XMLHttpRequest();
    http.open("POST", "/getShare", true);
    http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    var params = "id=" + window.encodeURIComponent(id3);
    http.send((params));
    http.onload = function() {
      if(http.responseText=="404"){
          //error
          alert(http.responseText);
        }else{

         likes = JSON.parse(http.responseText);

          //build the comments div
          newLike = "";
          // alert("dd  "+likes.length)
          for ( i = 0;i <=likes.length - 1; i++) {

            newLike += 
            "<div class=\"well\" style=\"padding:10px 15px 10px 15px; margin-bottom:0px\"> "+
            "<div class=\"row\">"+
            "<div class=\"col-sm-1 pull-left\" style=\"padding: 0 0 0 0 ; "+
            "width:40px;height:40px;overflow:hidden\">"+
            "<img style=\"width:40px;  position: absolute; left: 50%; top: 50%; "+
            "-webkit-transform: translateY(-50%) translateX(-50%);  -moz-transform: translateY(-50%) translateX(-50%) ;\"src=\"/images/"+
            likes[i].email+"/profile/"+likes[i].img_profile_name+"\">"+
            "</div>"+
            "<div class=\"col-sm-10 pull-left\" style=\"padding: 0 0 0px 0px; margin: 0 0 0px 10px\">"+
            "<a href=\"/profile/"+
            likes[i].email+"\"><b>"+
            likes[i].name+"</b></a>"+
            "</div>";

            newLike += "<div class=\"col-sm-11 pull-left\" style=\"padding: 0 0 0px 0px; overflow-wrap: break-word; "+
            "margin: 0 0 0 10px\">"+
            likes[i].occupation+"</div>"+
            "</div>"+
            "</div>"+
            "</div>";

          };
          // alert(newLike);
          //put generated html to the div
          buttonOnClick = "#buttonShare"+id3;
          newOnClick = "hideShare('"+id3+"')";
          $(buttonOnClick).attr("onClick", newOnClick);
          $(buttonOnClick).css("color", "rgb(45, 99, 99)");
          idd="showComment"+id3;
          document.getElementById(idd).innerHTML =newLike;
        }

        
      }

    }


    function sendLike(id){
      var http = new XMLHttpRequest();
      http.open("POST", "/addLike", true);
      http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
      var params = "id=" + window.encodeURIComponent(id);        
      http.send((params));
      http.onload = function() {
        if(http.responseText=="404"){
          //error
          alert(http.responseText);
        }else{
          var likeNumber = document.getElementById('like'+id)
          .innerHTML.replace('&nbsp; ','').replace(' ','');


          button = "#iconLike"+id;
          if(http.responseText=="like"){
            document.getElementById('like'+id).innerHTML = "&nbsp; "+((+likeNumber)+1);
            $(button).css("color", "rgb(45, 99, 99)");
          }else{
            document.getElementById('like'+id).innerHTML = "&nbsp; "+((+likeNumber)-1);
            $(button).css("color", "#3b9798");
          }
        }
      }
    }


    function sendShare(id){
      var http = new XMLHttpRequest();
      http.open("POST", "/addShare", true);
      http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
      var params = "id=" + window.encodeURIComponent(id);        
      http.send((params));
      http.onload = function() {
        alert(http.responseText);
      }
    }


    var observe;
    if (window.attachEvent) {
      observe = function (element, event, handler) {
        element.attachEvent('on'+event, handler);
      };
    }
    else {
      observe = function (element, event, handler) {
        element.addEventListener(event, handler, false);
      };
    }
    function init(id_str, delay) {
  var delay=(+delay); //1 seconds
  setTimeout(function(){ var text = document.getElementById(id_str);
    function resize () {
      text.style.height = 'auto';
      text.style.height = text.scrollHeight+'px';
    }
    /* 0-timeout to get the already changed text */
    function delayedResize () {
      window.setTimeout(resize, 0);
    }
    observe(text, 'change',  resize);
    observe(text, 'cut',     delayedResize);
    observe(text, 'paste',   delayedResize);
    observe(text, 'drop',    delayedResize);
    observe(text, 'keydown', delayedResize);

    text.focus();
    text.select();
    resize();
  }, delay); 

}
</script>


<style type="text/css">
  textarea.auto-resize {
    overflow: hidden;
    padding: 10px;
    outline: none;
    resize: none;
  }
</style>
